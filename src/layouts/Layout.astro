---
/**
 * Main Layout component
 * Single Responsibility: Provide HTML structure and SEO metadata
 */
import landingImage from '../assets/glow-salon-landing.webp';
import headerLogo from '../assets/glow-salon-alt-header-logo.webp';
import hairServiceImage from '../assets/services/hair.webp';
import nailServiceImage from '../assets/services/nails.webp';
import makeupServiceImage from '../assets/services/makeup-artist.webp';
import giftCardImage from '../assets/services/salon-egift.webp';
import StructuredData from '../components/SEO/StructuredData.astro';
import {
	generateWebPageSchema,
	generateLocalBusinessSchema,
	generateArticleSchema,
} from '../utils/structuredData';
import { BUSINESS_INFO, SERVICES } from '../config/constants';

export interface Props {
	title: string;
	description: string;
	canonicalURL?: string;
	ogImage?: string;
	ogType?: string;
	articlePublishedTime?: string;
	articleModifiedTime?: string;
	articleAuthor?: string;
	articleSection?: string;
	articleTag?: string;
}

const {
	title,
	description,
	canonicalURL = Astro.url.href,
	ogImage = landingImage.src,
	ogType = "website",
	articlePublishedTime,
	articleModifiedTime,
	articleAuthor,
	articleSection,
	articleTag,
} = Astro.props;

// Generate structured data based on page type
let structuredData;
if (articlePublishedTime) {
	structuredData = generateArticleSchema(
		title,
		description,
		canonicalURL,
		articlePublishedTime,
		articleModifiedTime,
		articleAuthor,
		articleSection,
		articleTag
	);
} else {
	structuredData = generateWebPageSchema(title, description, canonicalURL);
}

const localBusinessSchema = generateLocalBusinessSchema();
---
<!doctype html>
<html lang="en" role="document">
	<head>
		<!-- DNS Prefetch for external domains -->
		<link rel="dns-prefetch" href="//www.googletagmanager.com">
		<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
		<link rel="dns-prefetch" href="//fonts.googleapis.com">
		<link rel="dns-prefetch" href="//fonts.gstatic.com">
		<link rel="dns-prefetch" href="//www.facebook.com">
		<link rel="dns-prefetch" href="//www.instagram.com">
		<link rel="dns-prefetch" href="//glowsalonwestclay.glossgenius.com">
		<link rel="dns-prefetch" href="//formspree.io">

		<!-- Preconnect to critical external domains -->
		<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
		<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

		<!-- Preload critical fonts -->
		<link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@300;400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
		<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@300;400;500;600&display=swap"></noscript>

		<!-- Preload critical images -->
		<link rel="preload" href={landingImage.src} as="image" fetchpriority="high">
		<link rel="preload" href={headerLogo.src} as="image">
		<link rel="preload" href={hairServiceImage.src} as="image">
		<link rel="preload" href={nailServiceImage.src} as="image">
		<link rel="preload" href={makeupServiceImage.src} as="image">
		<link rel="preload" href={giftCardImage.src} as="image">
		
		<!-- Preload critical CSS -->
		<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
		<noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer"></noscript>

		<!-- ahrefs analytics -->
		<script src="https://analytics.ahrefs.com/analytics.js" data-key="cLD7yENK+8muOupoEIIYwg" async></script>
		<!-- Google Analytics (gtag.js) -->
		<script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-YJS85CR3ET"></script>
		<script type="text/partytown">
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'G-YJS85CR3ET', {
		    page_title: '{title}',
		    page_location: '{canonicalURL}'
		  });
		</script>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no">
		<meta name="theme-color" content="#e7d7c9">
		<meta name="msapplication-TileColor" content="#e7d7c9">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">
		<meta name="apple-mobile-web-app-title" content="Glow Salon & Spa">
		
		<!-- Favicon and App Icons -->
		<link rel="icon" type="image/webp" href="/glow-salon-logo.webp" />
		<link rel="apple-touch-icon" href="/glow-salon-logo.webp">
		<link rel="manifest" href="/site.webmanifest">

		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalURL} />

		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title}>
		<meta name="description" content={description}>
		<meta name="author" content="Glow Salon & Spa">
		<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
		<meta name="googlebot" content="index, follow">
		<meta name="bingbot" content="index, follow">

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={ogType}>
		<meta property="og:url" content={canonicalURL}>
		<meta property="og:title" content={title}>
		<meta property="og:description" content={description}>
		<meta property="og:image" content={ogImage}>
		<meta property="og:image:width" content="1200">
		<meta property="og:image:height" content="630">
		<meta property="og:image:alt" content="Glow Salon & Spa - Professional Beauty Services in Carmel, Indiana">
		<meta property="og:site_name" content="Glow Salon & Spa">
		<meta property="og:locale" content="en_US">
		<meta property="og:phone_number" content={BUSINESS_INFO.phone}>
		<meta property="og:street_address" content={BUSINESS_INFO.address.street}>
		<meta property="og:locality" content={BUSINESS_INFO.address.city}>
		<meta property="og:region" content={BUSINESS_INFO.address.state}>
		<meta property="og:postal_code" content={BUSINESS_INFO.address.zip}>
		<meta property="og:country_name" content="United States">

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image">
		<meta property="twitter:url" content={canonicalURL}>
		<meta property="twitter:title" content={title}>
		<meta property="twitter:description" content={description}>
		<meta property="twitter:image" content={ogImage}>
		<meta property="twitter:image:alt" content="Glow Salon & Spa - Professional Beauty Services in Carmel, Indiana">

		<!-- Additional SEO Meta Tags -->
		<meta name="geo.region" content="US-IN">
		<meta name="geo.placename" content="Carmel, Indiana">
		<meta name="geo.position" content="39.924550;-86.183260">
		<meta name="ICBM" content="39.924550, -86.183260">
		<meta name="DC.title" content={title}>
		<meta name="DC.description" content={description}>
		<meta name="DC.creator" content={BUSINESS_INFO.name}>
		<meta name="DC.publisher" content={BUSINESS_INFO.name}>
		<meta name="DC.language" content="en">
		<meta name="DC.coverage" content={`${BUSINESS_INFO.address.city}, Indiana`}>
		<meta name="DC.subject" content="Beauty Salon, Hair Services, Nail Services, Makeup Services">

		<!-- Structured Data -->
		<StructuredData data={[structuredData, localBusinessSchema]} />

	</head>
	<body>
		<a href="#main-content" class="skip-link">Skip to main content</a>
		<header role="banner">
			<!-- header content will be slotted in -->
		</header>
		<main id="main-content" role="main">
			<slot />
		</main>
		<footer role="contentinfo">
			<!-- footer content will be slotted in -->
		</footer>
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		min-height: 100%;
	}
	.skip-link {
		position: absolute;
		left: -999px;
		top: auto;
		width: 1px;
		height: 1px;
		overflow: hidden;
		z-index: 1000;
		background: #fff;
		color: #333;
		padding: 8px 16px;
		border: 2px solid #333;
		border-radius: 4px;
	}
	.skip-link:focus {
		left: 16px;
		top: 16px;
		width: auto;
		height: auto;
		font-size: 1rem;
		outline: none;
	}
</style>
